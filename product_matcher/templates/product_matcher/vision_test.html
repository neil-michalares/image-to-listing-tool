{% extends 'product_matcher/base.html' %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">Google Cloud Vision Test</h1>

    <!-- Upload Form -->
    <form method="post" enctype="multipart/form-data" class="mb-8">
        {% csrf_token %}
        <div class="flex items-center gap-4">
            <input type="file" name="image" accept="image/*" required class="border p-2 rounded">
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Analyze Image
            </button>
        </div>
    </form>

    {% if error %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-8">
            {{ error }}
        </div>
    {% endif %}

    {% if results %}
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Left Column -->
            <div>
                <h2 class="text-xl font-semibold mb-4">Uploaded Image</h2>
                <img src="{{ results.image_url }}" alt="Uploaded image" class="max-w-full rounded shadow-lg mb-6">

                <!-- eBay Matches -->
                {% if results.web_matches.ebay_listings %}
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold mb-3 text-green-600">Found eBay Listings</h2>
                        <div class="space-y-2">
                            {% for listing in results.web_matches.ebay_listings %}
                                <div class="bg-white p-4 rounded shadow">
                                    <a href="{{ listing.url }}" target="_blank" class="text-blue-600 hover:text-blue-800">
                                        {{ listing.title }}
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                <!-- Similar Products -->
                {% if results.web_matches.similar_images %}
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold mb-3">Similar Images</h2>
                        <div class="grid grid-cols-2 gap-4">
                            {% for image in results.web_matches.similar_images %}
                                <div class="bg-white p-2 rounded shadow">
                                    <a href="{{ image.url }}" target="_blank">
                                        <img src="{{ image.url }}" alt="Similar image" class="w-full h-32 object-cover rounded">
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Right Column -->
            <div>
                <!-- Labels -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-3">Labels</h2>
                    <div class="space-y-2">
                        {% for label in results.labels %}
                            <div class="flex justify-between bg-gray-50 p-2 rounded">
                                <span>{{ label.description }}</span>
                                <span class="text-gray-600">{{ label.score }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Objects -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-3">Objects</h2>
                    <div class="space-y-2">
                        {% for object in results.objects %}
                            <div class="flex justify-between bg-gray-50 p-2 rounded">
                                <span>{{ object.name }}</span>
                                <span class="text-gray-600">{{ object.score }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Web Entities -->
                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-3">Web Entities</h2>
                    <div class="space-y-2">
                        {% for entity in results.web_entities %}
                            <div class="flex justify-between bg-gray-50 p-2 rounded">
                                <span>{{ entity.description }}</span>
                                <span class="text-gray-600">{{ entity.score }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Web Pages -->
                {% if results.web_matches.pages %}
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold mb-3">Related Web Pages</h2>
                        <div class="space-y-2">
                            {% for page in results.web_matches.pages %}
                                <div class="bg-gray-50 p-3 rounded">
                                    <a href="{{ page.url }}" target="_blank" class="text-blue-600 hover:text-blue-800">
                                        {{ page.title }}
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                <!-- Text Detection -->
                {% if results.text %}
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold mb-3">Detected Text</h2>
                        <div class="bg-gray-50 p-3 rounded">
                            <pre class="whitespace-pre-wrap">{{ results.text }}</pre>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>
{% endblock %} 